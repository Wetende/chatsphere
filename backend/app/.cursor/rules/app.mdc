---
alwaysApply: true
description: FastAPI app-layer rules (routers, schemas, services, models, core, utils). PRD- and plan-aligned.
---

## App Layer Rules (backend/app)

- Follow PRDs in [plan/prds/](mdc:plan/prds) and plan docs [05-backend-implementation.md](mdc:plan/05-backend-implementation.md), [03-technical-architecture.md](mdc:plan/03-technical-architecture.md).
- Routers: thin orchestration; use `@router.*`, `response_model`, tags, examples; DI for DB/auth/settings.
- Schemas: strict Pydantic I/O models; version-safe contracts.
- Services: encapsulate business logic and transactions; get sessions from app/core/database.py; call agent via interfaces.
- Models: SQLAlchemy only; enforce indices/constraints per DB design plan.
- Core: centralize DB session, settings, lifespan; avoid global state.
- Utils: typed error mapping and helpers; no DB creation here.
- Docs: ensure `/docs` coverage; meaningful operation IDs.
- FastAPI Tutorial/Advanced applies for dependencies, security, callbacks, client generation.
